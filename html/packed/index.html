<html>
	<head>
		<title>Snake 3d game</title>
		<style type="text/css">
		body {
			display: block;
			background-color:0;
			width: 100%;
			height: 100%;
			margin: 0;
		}
		canvas {
			background-color:0;
			display: block;
			margin: 0px auto;
		}
		</style>
	</head>
	<body>
		<canvas id="snake"></canvas>
	</body>
	<script type="text/javascript">
	
	var aa=Number.MAX_VALUE,ba=Number.MIN_VALUE,da=Math.PI,ea=Math.cos,fa=Math.sin;function ka(b,a){return[b[0]-a[0],b[1]-a[1]]}function la(b){var a=1/Math.sqrt(b[0]*b[0]+b[1]*b[1]);Infinity==a&&(a=aa);-Infinity==a&&(a=ba);return[b[0]*a,b[1]*a]}function e(b,a,c){return[void 0===b?0:b,void 0===a?0:a,void 0===c?0:c]}function h(b,a){return[b[0]+a[0],b[1]+a[1],b[2]+a[2]]}function k(b,a){return[b[0]-a[0],b[1]-a[1],b[2]-a[2]]}function n(b,a){return[b[0]*a,b[1]*a,b[2]*a]}
function ma(b,a){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]}function p(b,a){return e(b[1]*a[2]-b[2]*a[1],b[2]*a[0]-b[0]*a[2],b[0]*a[1]-b[1]*a[0])}function r(b){return Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])}function t(b){var a=1/r(b);NaN==a&&(a=aa);Infinity==a&&(a=aa);-Infinity==a&&(a=ba);return n(b,a)}function v(b,a,c){return h(n(b,1-c),n(a,c))}function na(b){for(var a=e(),c=0;c<b.length;c++)a=h(a,b[c]);return n(a,1/parseFloat(b.length))}
function x(b){var a=(void 0===b?0:b)/180*da;b=ea(a);a=fa(a);return[1,0,0,0,b,-a,0,a,b]}function A(b){var a=(void 0===b?0:b)/180*da;b=ea(a);a=fa(a);return[b,0,a,0,1,0,-a,0,b]}function B(b,a){var c=b[0],d=b[1],f=b[2],g=a/180*da,l=ea(g);g=fa(g);var m=1-l;return[c*c+(1-c*c)*l,c*d*m-f*g,c*f*m+d*g,c*d*m+f*g,d*d+(1-d*d)*l,d*f*m-c*g,c*f*m-d*g,d*f*m+c*g,f*f+(1-f*f)*l]}
function oa(b,a){return[b[0]*a[0]+b[1]*a[3]+b[2]*a[6],b[0]*a[1]+b[1]*a[4]+b[2]*a[7],b[0]*a[2]+b[1]*a[5]+b[2]*a[8],b[3]*a[0]+b[4]*a[3]+b[5]*a[6],b[3]*a[1]+b[4]*a[4]+b[5]*a[7],b[3]*a[2]+b[4]*a[5]+b[5]*a[8],b[6]*a[0]+b[7]*a[3]+b[8]*a[6],b[6]*a[1]+b[7]*a[4]+b[8]*a[7],b[6]*a[2]+b[7]*a[5]+b[8]*a[8]]}function C(b,a){return[b[0]*a[0]+b[1]*a[1]+b[2]*a[2],b[0]*a[3]+b[1]*a[4]+b[2]*a[5],b[0]*a[6]+b[1]*a[7]+b[2]*a[8]]}
function pa(b,a){var c=[b[0],b[1],b[2],1];c=[c[0]*a[0]+c[1]*a[4]+c[2]*a[8]+c[3]*a[12],c[0]*a[1]+c[1]*a[5]+c[2]*a[9]+c[3]*a[13],c[0]*a[2]+c[1]*a[6]+c[2]*a[10]+c[3]*a[14],c[0]*a[3]+c[1]*a[7]+c[2]*a[11]+c[3]*a[15]];return[c[0]/c[3],c[1]/c[3],c[2]/c[3]]}var qa;function F(){for(var b=H,a=0;a<b.l.length;a++)b.l[a].ca(b);b.l.sort(ra);for(a=0;a<b.l.length;a++)b.l[a].$(b.canvas)}function sa(b,a){var c=h(a,n(b.position,-1));c=C(c,b.I);c=h(c,b.A);c=pa(c,b.da);c=n(c,b.X);return h(c,b.O)}
function K(b,a,c){this.position=b;this.i=e();this.color=void 0===c?"#FFEEEE":c;this.W=e(void 0===a?.5:a);this.ea=10;this.enabled=!0;qa.l.push(this)}K.prototype.ca=function(b){if(this.enabled){this.i=sa(b,this.position);var a=h(this.position,n(b.position,-1));a=C(a,b.I);a=h(a,b.A);a=h(a,this.W);a=pa(a,b.da);a=n(a,b.X);this.ea=r(k(this.i,h(a,b.O)))}};K.prototype.$=function(b){this.enabled&&(b.fillStyle=this.color,b.beginPath(),b.arc(this.i[0],this.i[1],this.ea,0,2*Math.PI),b.closePath(),b.fill())};
function L(b,a,c,d,f,g){this.w=[b,a,c];this.h=[b,a,c];this.position=na(this.w);this.i=e();this.color=void 0===d?"#FFEEEE":d;this.na=void 0===g?!0:g;this.filled=void 0===f?!0:f;this.enabled=!0;qa.l.push(this)}L.prototype.ca=function(b){if(this.enabled){this.i=sa(b,this.position);for(var a=0;a<this.h.length;a++)this.h[a]=sa(b,this.w[a])}};
L.prototype.$=function(b){var a;if(a=this.enabled){if(a=this.na){a=this.h[0];var c=ka(this.h[1],a);c=la([c[1],-c[0]]);a=ka(a,this.h[2]);a=0<c[0]*a[0]+c[1]*a[1]}a=!a}if(a){b.fillStyle=this.color;b.strokeStyle=this.color;b.beginPath();a=this.h[this.h.length-1];b.moveTo(a[0],a[1]);for(a=0;a<this.h.length;a++)b.lineTo(this.h[a][0],this.h[a][1]);b.closePath();this.filled&&b.fill();b.stroke()}};function ra(b,a){return b.i[2]<a.i[2]?-1:b.i[2]>a.i[2]?1:0}function ta(){ua(this,0)}
function ua(b,a){b.id=a;qa.l=[];b.M=null;b.L=3;b.K=0;b.N=6+3*a;b.U=parseInt(a/4+2);b.C=[];var c=null;if(0==a||a%3==parseInt(a/3)%3)b.U=0;switch(a%3){case 0:va();c=wa();break;case 1:var d=void 0===d?11:d;for(var f=[],g=2/d,l=[x(0),x(90),x(180),x(270),A(90),A(270)],m=[.5,.6,.7,.8,.9,1],q=0;q<l.length;q++)for(var y=0;y<d;y++)for(var z=0;z<d;z++){var G=C(n(e(y*g-1,z*g-1,1),4),l[q]);c=C(n(e((y+1)*g-1,z*g-1,1),4),l[q]);var J=C(n(e((y+1)*g-1,(z+1)*g-1,1),4),l[q]),D=C(n(e(y*g-1,(z+1)*g-1,1),4),l[q]),u=parseInt(255*
m[q]),S=parseInt(195*m[q]);u=M(u,u,u);1==(y+z)%2&&(u=M(S,S,S));f.push(new L(G,c,J,u));f.push(new L(G,J,D,u))}f=[e(4.5,4.5,4.5),e(4.5,-4.5,4.5),e(-4.5,4.5,4.5),e(-4.5,-4.5,4.5),e(4.5,4.5,-4.5),e(4.5,-4.5,-4.5),e(-4.5,4.5,-4.5),e(-4.5,-4.5,-4.5)];g=[[0,2,1],[1,2,3],[4,5,6],[5,7,6],[0,6,2],[0,4,6],[1,3,7],[1,7,5],[0,1,5],[0,5,4],[2,6,7],[2,7,3]];l=[];for(m=0;m<g.length;m++)l.push([f[g[m][0]],f[g[m][1]],f[g[m][2]]]);c=l;break;case 2:q=void 0===q?32:q;y=void 0===y?4:y;D=void 0===D?7:D;z=void 0===z?8:z;
G=void 0===G?6:G;d=[];c=[];for(J=0;J<=q;J++)S=C(e(y,0,0),A(360/q*J)),c.push(S);J=e(0,.5*D,0);D=e(0,.5*-D,0);S=1/z;u=1/G;for(var U=0;U<q;U++){for(var I,ca=h(J,c[U]),ha=h(J,c[U+1]),ia=h(D,c[U]),ja=h(D,c[U+1]),w=0;w<G;w++){var E=(G-w)*u*30;I=M(195+E,195+E,195+E);1==(U+w)%2&&(I=M(255-E,255-E,255-E));upperStart=v(J,ca,w*u);upperEnd=v(J,ha,w*u);downerStart=v(J,ca,(w+1)*u);downerEnd=v(J,ha,(w+1)*u);d.push(new L(upperStart,downerEnd,upperEnd,I));d.push(new L(upperStart,downerStart,downerEnd,I))}for(w=0;w<
G;w++)E=(G-w)*u*30,I=M(195+E,195+E,195+E),1==(U+w)%2&&(I=M(255-E,255-E,255-E)),upperStart=v(D,ia,(w+1)*u),upperEnd=v(D,ja,(w+1)*u),downerStart=v(D,ia,w*u),downerEnd=v(D,ja,w*u),d.push(new L(upperStart,downerEnd,upperEnd,I)),d.push(new L(upperStart,downerStart,downerEnd,I));for(w=0;w<z;w++)E=ca[0]/y*.5+.5,I=parseInt(255*(.6*E+.4)),E=parseInt(195*(.6*E+.4)),I=M(I,I,I),1==(U+w)%2&&(I=M(E,E,E)),upperStart=v(ca,ia,w*S),upperEnd=v(ha,ja,w*S),downerStart=v(ca,ia,(w+1)*S),downerEnd=v(ha,ja,(w+1)*S),d.push(new L(upperStart,
downerEnd,upperEnd,I)),d.push(new L(upperStart,downerStart,downerEnd,I))}f=void 0===f?16:f;m=void 0===m?4:m;g=void 0===g?7:g;l=void 0===l?.5:l;q=[];y=[];for(z=0;z<=f;z++)G=C(e(m+l,0,0),A(360/f*z)),y.push(G);m=e(0,.5*g+l,0);g=e(0,.5*-g-l,0);for(l=0;l<f;l++)z=h(m,y[l]),G=h(m,y[l+1]),d=h(g,y[l]),c=h(g,y[l+1]),q.push([m,z,G]),q.push([g,c,d]),q.push([z,c,G]),q.push([z,d,c]);c=q}for(f=0;f<c.length;f++)g=c[f],b.C.push(new xa(g[0],g[1],g[2]));b.a=new ya(b.C);b.b=new za(b.a);Aa(b.b,!1);b.j=[new N(M(51,255,
51)),new N(M(51,255,51)),new N(M(51,255,51))];b.g=[];for(f=0;f<b.U;f++)b.g.push(new N(M(0,0,200)))}
ta.prototype.update=function(b){for(var a=0;a<this.j.length;a++)this.j[a].update(b);for(a=0;a<this.g.length;a++)this.g[a].update(b);for(b=0;b<this.j.length;b++)1>r(k(this.a.c,this.j[b].position))&&(this.j[b].remove(Ba(this.a)),this.b.B+=.5,this.K+=1);for(b=0;b<this.g.length;b++)1>r(k(this.a.c,this.g[b].position))&&(this.g[b].remove(Ba(this.a)),this.b.B-=.2,--this.L);for(b=6;b<this.b.o.length-1;b++)1>r(k(this.a.c,this.b.o[b]))&&(this.L=0)};
ta.prototype.start=function(){Aa(this.b,!0);for(var b=0;b<this.j.length;b++)this.j[b].remove(Ba(this.a));for(b=0;b<this.g.length;b++)this.g[b].remove(Ba(this.a))};function Ca(){var b=O;Aa(b.b,!1);for(var a=0;a<b.j.length;a++)b.j[a].remove(e());for(a=0;a<b.g.length;a++)b.g[a].remove(e())}
function Da(){var b=O,a=Ea;if(null==b.M){for(var c=[],d=0;d<b.C.length;d++){var f=new L(b.C[d].D,b.C[d].F,b.C[d].G,"rgb(255,255,255)",!1,!1);c.push(f)}c.push(new K(e(8,0,0),.5,M(255,0,0)));c.push(new K(e(0,8,0),.5,M(0,255,0)));c.push(new K(e(0,0,8),.5,M(0,0,255)));b.M=c}for(c=0;c<b.M.length;c++)b.M[c].enabled=a}
function va(){function b(a,b,c,d,f){return C(n(t(e(a*c-.5,b*c-.5,.5)),d),f)}var a=void 0===a?5:a;var c=void 0===c?9:c;for(var d=[],f=1/c,g=[x(0),x(90),x(180),x(270),A(90),A(270)],l=0;l<g.length;l++)for(var m=0;m<c;m++)for(var q=0;q<c;q++){var y=b(m,q,f,a,g[l]),z=b(m+1,q,f,a,g[l]),G=b(m+1,q+1,f,a,g[l]),J=b(m,q+1,f,a,g[l]),D=.5*b(m+.5,q+.5,f,1,g[l])[0]+.5,u=parseInt(255*(.6*D+.4));D=parseInt(195*(.6*D+.4));u=M(u,u,u);1==(m+q)%2&&(u=M(D,D,D));d.push(new L(y,z,G,u));d.push(new L(y,G,J,u))}}
function wa(){function b(a,b,c,d,f){return C(n(t(e(a*c-.5,b*c-.5,.5)),d),f)}var a=void 0===a?9:a;for(var c=[],d=1/a,f=[x(0),x(90),x(180),x(270),A(90),A(270)],g=0;g<f.length;g++)for(var l=0;l<a;l++)for(var m=0;m<a;m++){var q=b(l,m,d,5.5,f[g]),y=b(l+1,m+1,d,5.5,f[g]),z=b(l,m+1,d,5.5,f[g]);c.push([q,b(l+1,m,d,5.5,f[g]),y]);c.push([q,y,z])}return c}function M(b,a,c,d){function f(a){a=a.toString(16);return 1==a.length?"0"+a:a}return"#"+f(b)+f(a)+f(c)+f(void 0===d?255:d)}
function ya(b){this.V=b=void 0===b?[]:b;this.currentNode=this.V[0];this.c=this.currentNode.Y;this.v=this.currentNode.pa;for(var a=0;a<b.length;a++)b[a].name=a;for(a=0;a<b.length;a++)for(var c=0;c<b.length;c++)if(a!=c)for(var d=b[a],f=b[c],g=0;g<f.w.length;g++){var l=f.w[g],m=f.w[(g+1)%f.w.length];if(Fa(d.D,d.F,l,m)){d.P=f;break}if(Fa(d.F,d.G,l,m)){d.R=f;break}if(Fa(d.G,d.D,l,m)){d.S=f;break}}}ya.prototype.push=function(b){this.qa.push(b)};
function Ba(b){return b.V[Math.floor(Math.random()*(b.V.length-0))+0].Y}ya.prototype.moveTo=function(b,a,c){var d=Ga(this.currentNode,b,this.c,a,c);a=k(Ga(this.currentNode,b,h(this.c,this.v),a,c),d);this.currentNode=b;this.c=d;this.v=a};function Ga(b,a,c,d,f){c=k(c,d);f=t(k(f,d));return h(h(d,n(f,ma(f,c))),n(p(a.H,f),ma(p(b.H,f),c)))}
function xa(b,a,c){this.D=b;this.F=a;this.G=c;this.w=[b,a,c];var d=na([b,a,c]);this.Y=d;this.H=t(p(k(a,d),k(c,d)));this.pa=t(k(a,d));d=k(a,b);a=k(c,a);b=k(b,c);this.ka=this.D;this.ha=t(p(this.H,d));this.la=this.F;this.ia=t(p(this.H,a));this.ma=this.G;this.ja=t(p(this.H,b));this.S=this.R=this.P=null}function Fa(b,a,c,d){return.001>r(k(b,c))&&.001>r(k(a,d))||.001>r(k(b,d))&&.001>r(k(a,c))}
function N(b){var a=e();var c=void 0===c?.4:c;var d=void 0===d?6:d;this.position=a;this.ba=new K(a,0,b);this.oa=c;this.u=0;this.ga=d}N.prototype.remove=function(b){this.position=b;this.u=-Math.abs(this.u)};N.prototype.update=function(b){1>this.u&&(b=this.u+this.ga*b,1<b?b=1:0>this.u&&0<b&&(this.ba.position=this.position),this.u=b,this.ba.W=e(this.oa*Math.abs(this.u)))};
function za(b){this.a=b;this.position=b.c;this.aa=new K(this.position,.45,M(40,140,40));this.fa=new K(h(this.position,n(b.v,.525)),.1,M(30,130,30));this.rotationAngle=0;this.B=3.5;this.o=[];this.s=[];this.J=this.position;this.enabled=!0}za.prototype.rotate=function(b){this.rotationAngle=b};function Aa(b,a){b.enabled=a;b.aa.enabled=a;b.fa.enabled=a;for(var c=0;c<b.s.length;c++)b.s[c].enabled=a}
za.prototype.update=function(b){var a=140*this.rotationAngle*b,c=this.a;b*=7;b=h(c.c,n(c.v,void 0===b?1:b));var d=c.currentNode;0>ma(d.ha,k(b,d.ka))?null!=c.currentNode.P&&c.moveTo(c.currentNode.P,c.currentNode.D,c.currentNode.F):(d=c.currentNode,0>ma(d.ia,k(b,d.la))?null!=c.currentNode.R&&c.moveTo(c.currentNode.R,c.currentNode.F,c.currentNode.G):(d=c.currentNode,0>ma(d.ja,k(b,d.ma))?null!=c.currentNode.S&&c.moveTo(c.currentNode.S,c.currentNode.G,c.currentNode.D):c.c=b));c=this.a;c.v=t(C(c.v,B(c.currentNode.H,
void 0===a?0:a)));this.position=this.a.c;this.aa.position=this.a.c;this.fa.position=h(this.a.c,n(this.a.v,.525));a=r(k(this.J,this.position));1<a&&(--a,this.J=h(this.J,t(k(this.position,this.J))),this.o.unshift(this.J),this.o.pop());for(c=this.s.length;c<this.B;c++)this.s.push(new K(e(),0,M(40,Math.max(30,parseInt(142-3*c)),40)));for(c=this.o.length;c<this.s.length+1;c++)this.o.unshift(this.position);for(c=0;c<this.s.length;c++)this.s[c].position=v(this.o[c+1],this.o[c],a),this.s[c].W=e(Math.min(.5,
.25*(this.B-c)))};
var Ha=1/30,Ia,Ka=Ja(),P=document.documentElement.clientWidth,Q=document.documentElement.clientHeight,R=Math.min(P,Q),La=0,T=function(){function b(a){c.touches=[];for(var b=0;b<a.touches.length;b++)c.touches.push([a.touches[b].clientX,a.touches[b].clientY]);a.preventDefault()}function a(a,b){document.addEventListener(a,b,{passive:!1})}var c={key:[],T:!1,m:[0,0],touches:[],f:function(a,b,c,l){var d;if(d=this.T){d=this.m[0];var f=this.m[1];d=d>=a&&d<=c&&f>=b&&f<=l}if(d)return!0;for(d=0;d<this.touches.length;d++){f=
this.touches[d][0];var g=this.touches[d][1];if(f>=a&&f<=c&&g>=b&&g<=l)return!0}return!1},Z:function(){for(var a=0;200>a;a++)this.key[a]=!1}};c.Z();a("keydown",function(a){c.key[a.keyCode]=!0});a("keyup",function(a){c.key[a.keyCode]=!1});a("click",function(){});a("mousedown",function(a){c.T=!0;c.m[0]=a.clientX;c.m[1]=a.clientY});a("mouseup",function(a){c.T=!1;c.m[0]=a.clientX;c.m[1]=a.clientY});a("mousemove",function(a){c.m[0]=a.clientX;c.m[1]=a.clientY});a("touchstart",b);a("touchmove",b);a("touchend",
b);a("touchcancel",b);return c}(),Ma=document.getElementById("snake"),V=Ma.getContext("2d"),H=new function(){this.l=[];this.O=e(50,50);this.X=100;this.I=[1,0,0,0,1,0,0,0,1];this.da=[1,0,0,0,0,1,0,0,0,0,3,-1,0,0,-4,0];this.A=e(0,0,20);this.position=e();this.canvas=V;qa=this};Na();var W=0,X=1,Y=0,Oa=[1,0,0,0,1,0,0,0,1],Pa=t(e(1,1,1)),O=new ta,Ea=!1,Qa=!1;function Ja(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}
function Ra(){var b=.13*R,a=Q-.1*R,c=.12*R;V.fillStyle="#FFFFFF33";V.strokeStyle="#FFFFFF11";V.beginPath();V.arc(b+.2*c,a,.5*c,.838*Math.PI,1.162*Math.PI,!0);V.arc(b+.2*c,a,.3*c,1.3*Math.PI,.7*Math.PI);V.closePath();V.fill();V.stroke();V.beginPath();V.moveTo(b+.04*c-.8*c,a);V.lineTo(b+.04*c-.4*c,a+.4*c);V.lineTo(b+.04*c-.4*c,a+.12*c);V.lineTo(b+.04*c-.04*c,a+.12*c);V.lineTo(b+.04*c-.04*c,a-.12*c);V.lineTo(b+.04*c-.4*c,a-.12*c);V.lineTo(b+.04*c-.4*c,a-.4*c);V.closePath();V.fill();V.stroke()}
function Sa(){var b=P-.1*R,a=Q-.1*R,c=.1*R;V.fillStyle="#FFFFFF33";V.strokeStyle="#FFFFFF11";V.beginPath();V.moveTo(b+.5*c,a);V.lineTo(b,a+.5*c);V.lineTo(b-.5*c,a+.5*c);V.lineTo(b,a);V.lineTo(b-.5*c,a-.5*c);V.lineTo(b,a-.5*c);V.closePath();V.fill();V.stroke()}
function Ta(){var b=.1*R,a=Q-.1*R,c=.1*R;V.fillStyle="#FFFFFF33";V.strokeStyle="#FFFFFF11";V.beginPath();V.moveTo(b-.5*c,a);V.lineTo(b,a+.5*c);V.lineTo(b+.5*c,a+.5*c);V.lineTo(b,a);V.lineTo(b+.5*c,a-.5*c);V.lineTo(b,a-.5*c);V.closePath();V.fill();V.stroke()}function Ua(){var b=t(O.b.position),a=Math.acos(la([b[0],b[2]])[0])/Math.PI*180,c=Math.acos(b[1])/Math.PI*180-90;a=0<b[2]?a+90:90-a;return[c,a]}
function Z(b){La=b;T.Z();switch(La){default:case 0:Oa=H.I;Ca();break;case 4:W=1;break;case 1:break;case 3:for(b=0;30>b;b++)O.b.update(1/30);O.start();break;case 5:Ca();Y+=1;break;case 6:Ca()}}
function Va(){var b=Ja(),a=(b-Ka)/1E3;Ia=1/a;a>Ha&&(a=Ha);switch(La){default:case 0:if(0<W)W-=3*a,0>W&&(W=0),a=2*(W-.5),0<a?H.A=e(30*(1-a*a)*X,0,20):(O.id!=Y&&ua(O,Y),H.A=e(30*(-1+a*a)*X,0,20));else{T.key[32]&&(T.key[32]=!1,Z(4));(T.key[65]||T.key[37])&&0<Y&&(W=1,X=-1,--Y);if(T.key[68]||T.key[39])X=W=1,Y+=1;T.f(0,.5*Q,.3*P,Q)&&0<Y&&(W=1,X=-1,--Y);T.f(.7*P,.5*Q,P,Q)&&(X=W=1,Y+=1);T.f(.4*P,.5*Q,.6*P,Q)&&Z(4);O.update(a);Oa=oa(Oa,B(Pa,20*a));Pa=t(e(100*Pa[0]+(2*Math.random()-1),100*Pa[1]+(2*Math.random()-
1),100*Pa[2]+(2*Math.random()-1)));H.I=Oa;H.position=n(H.position,1-1*a);T.key[113]&&(T.key[113]=!1,Ea=!Ea,Da())}break;case 4:if(0<W){var c=W-1*a;.5>=c&&.5<W&&ua(O,Y);W=c;0>W&&(W=0);.5>W&&(O.update(a),H.position=O.b.position,a=Ua(),H.I=oa(B(e(1),a[0]),B(e(0,1),a[1])))}else Z(3);break;case 1:T.key[27]&&(T.key[27]=!1,Z(3));T.f(.7*P,0,P,.3*Q)&&Z(3);T.key[81]&&(T.key[81]=!1,Z(0));break;case 3:T.key[27]&&(T.key[27]=!1,Z(1));T.f(.7*P,0,P,.3*Q)&&Z(1);c=0;if(T.key[65]||T.key[37])c=1;if(T.key[68]||T.key[39])c=
-1;T.f(0,0,.5*P,Q)&&(c=1);T.f(.5*P,0,P,Q)&&(c=-1);O.b.rotate(c);O.b.update(a);O.update(a);H.position=O.b.position;a=Ua();H.I=oa(B(e(1),a[0]),B(e(0,1),a[1]));T.key[113]&&(T.key[113]=!1,Ea=!Ea,Da());O.N<=O.K&&Z(5);0>=O.L&&Z(6);break;case 5:if(0<W)W-=3*a,0>W&&(W=0),a=2*(W-.5),0<a?H.A=e(30*(1-a*a)*X,0,15):(O.id!=Y&&ua(O,Y),H.A=e(30*(-1+a*a)*X,0,15));else if(O.id==Y)Z(4);else{T.key[27]&&(T.key[27]=!1,--Y,Z(0));T.key[32]&&(T.key[32]=!1,X=W=1);if(T.key[65]||T.key[37])T.key[65]=!1,T.key[37]=!1,--Y,Z(0);if(T.key[68]||
T.key[39])T.key[68]=!1,T.key[39]=!1,X=W=1;T.f(0,.5*Q,.3*P,Q)&&(--Y,Z(0));T.f(.7*P,0,P,Q)&&(X=W=1);O.update(a)}break;case 6:T.key[27]&&(T.key[27]=!1,Z(0));T.key[32]&&(T.key[32]=!1,Z(4));if(T.key[65]||T.key[37])T.key[65]=!1,T.key[37]=!1,Z(0);if(T.key[68]||T.key[39])T.key[68]=!1,T.key[39]=!1,Z(4);T.f(0,.5*Q,.3*P,Q)&&Z(0);T.f(.7*P,0,P,Q)&&Z(0);O.update(a)}T.key[115]&&(T.key[115]=!1,Qa=!Qa,console.log(qa.l.length));V.fillStyle="#000011";V.fillRect(0,0,P,Q);switch(La){default:case 0:F();V.fillStyle="#FFFFFF";
V.textAlign="center";V.fillText("Level: "+(Y+1),.5*P,.25*Q-.17*R);V.fillText("need apples: "+O.N,.5*P,.25*Q-.1*R);V.fillText("rocks on level: "+O.U,.5*P,.25*Q-.03*R);a=.5*P;c=Q-.1*R;var d=.1*R;V.fillStyle="#FFFFFF33";V.strokeStyle="#FFFFFF11";V.beginPath();V.arc(a+.2*d,c,.6*d,.75*Math.PI,1.25*Math.PI,!0);V.arc(a+.2*d,c,.4*d,1.25*Math.PI,.75*Math.PI);V.closePath();V.fill();V.stroke();V.beginPath();V.moveTo(a,c);V.lineTo(a-.4*d,c+.4*d);V.lineTo(a-.4*d,c+.12*d);V.lineTo(a-.76*d,c+.12*d);V.lineTo(a-.76*
d,c-.12*d);V.lineTo(a-.4*d,c-.12*d);V.lineTo(a-.4*d,c-.4*d);V.closePath();V.fill();V.stroke();Ta();Sa();break;case 1:F();V.fillStyle="#FFFFFF";V.textAlign="center";V.fillText("PAUSE ",.5*P,.5*Q-.4*R);V.fillText("Q to quit ",.5*P,.5*Q+.4*R);V.fillText("Esc to continue ",.5*P,.5*Q+.45*R);break;case 4:F();V.fillStyle=M(0,0,0,parseInt(255*Math.max(0,1-Math.abs(3*W-1.5))));V.fillRect(0,0,P,Q);break;case 3:F();V.fillStyle="#FFFFFF";V.textAlign="start";V.textBaseline="middle";V.fillText(O.K+"/"+O.N,.15*
R,.1*R);a=.1*R;c=.1*R;d=.046*R;d=void 0===d?10:d;V.fillStyle="#33FF33";V.beginPath();V.arc(a,c,.5*d,0,2*Math.PI);V.closePath();V.fill();for(a=0;a<O.L;a++){c=.5*P+(a-1)*R*.05;d=Q-.1*R;var f=.05*R;f=void 0===f?10:f;V.fillStyle="#FF0000";V.beginPath();V.moveTo(c,d+.5*f);V.arc(c-.175*f,d,.25*f,.75*Math.PI,1.75*Math.PI);V.arc(c+.175*f,d,.25*f,1.25*Math.PI,2.25*Math.PI);V.closePath();V.fill()}a=P-.1*R;c=.1*R;d=.08*R;V.fillStyle="#FFFFFF33";V.strokeStyle="#FFFFFF11";V.rect(a-.5*d,c+.3*d,d,.2*d);V.rect(a-
.5*d,c-.1*d,d,.2*d);V.rect(a-.5*d,c-.5*d,d,.2*d);V.fill();V.stroke();Ta();Sa();break;case 5:F();V.fillStyle="#FFFFFF";V.textAlign="center";V.fillText("YOU WIN!",.5*P,.1*Q);Ra();Sa();break;case 6:F(),V.fillStyle="#FFFFFF",V.textAlign="center",V.fillText("YOU LOSE!",.5*P,.1*Q),Ra(),a=P-.1*R,c=Q-.1*R,d=.1*R,V.fillStyle="#FFFFFF33",V.strokeStyle="#FFFFFF11",V.beginPath(),V.arc(a,c,.6*d,.5*Math.PI,.2*Math.PI),V.arc(a,c,.4*d,.2*Math.PI,.5*Math.PI,!0),V.lineTo(a,c+.3*d),V.lineTo(a+.3*d,c+.5*d),V.lineTo(a,
c+.7*d),V.closePath(),V.fill(),V.stroke()}Qa&&(V.textAlign="end",V.fillText("FPS: "+Math.round(Ia),P-30,50));Ka=b;requestAnimationFrame(Va);if(P!=document.documentElement.clientWidth||Q!=document.documentElement.clientHeight)P=document.documentElement.clientWidth,Q=document.documentElement.clientHeight,R=Math.min(P,Q),Na()}requestAnimationFrame(Va);function Na(){var b=P,a=Q;Ma.width=b;Ma.height=a;var c=H;c.O=e(.5*b,.5*a);c.X=Math.min(b,a);c=32;a>b&&(c*=a/b);V.font=parseInt(c)+"pt Arial"};
	</script>
</html>