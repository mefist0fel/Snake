<html>
	<head>
		<title>Elements prot</title>
		<style type="text/css">
		body {
			display: block;
			background-color:0;
			width: 100%;
			height: 100%;
			margin: 0;
		}
		canvas {
			background-color:#ffffff;
			display: block;
			margin: 0px auto;
		}
		</style>
	</head>
	<body>
		<canvas id="snake"></canvas>
	</body>
	<script type="text/javascript" src="input.js"></script>
	<script type="text/javascript" src="geometry.js"></script>
	<!--
	<script type="text/javascript" src="camera.js"></script>
	<script type="text/javascript" src="jsfxr.js"></script>
	<script type="text/javascript" src="audio.js"></script>
	<script type="text/javascript" src="map.js"></script>
	<script type="text/javascript" src="hero.js"></script>-->
	<script type="text/javascript">
	var now,
		dt = 0,
		time = timestamp(),
		step = 1/30,
		width = 1024,
		height = 768;
	width = document.documentElement.clientWidth
	height = document.documentElement.clientHeight
	var centerOffcet = CreateVector3(width * 0.5, height * 0.5)
	var x = 0
	var y = 0
	var upVector = CreateVector3(0, 1)
	var rightVector = CreateVector3(1, 0)

	var worldMatrix = CreateUnitMatrix3()
	var projectionMatrix = CreateProjectionMatrix4(10.0, 10.0, 0.1, 20.0)
	var points = []

	for (var i = -5; i <= 5; i++) {
		for (var j = -5; j <= 5; j++) {
			points.push(CreateVector3( i, j, 5))
			points.push(CreateVector3( i, j,-5))
			points.push(CreateVector3( i, 5, j))
			points.push(CreateVector3( i,-5, j))
			points.push(CreateVector3( 5, i, j))
			points.push(CreateVector3(-5, i, j))
		}
	}


	// init
	var canvasElement = document.getElementById('snake');
	var canvas = canvasElement.getContext('2d');
	canvasElement.width = width;
	canvasElement.height = height;
	rect = canvasElement.getBoundingClientRect();

	var input = Input(rect, canvasElement);

	function timestamp() {
		return window.performance && window.performance.now ? window.performance.now() : new Date().getTime();
	}

	function ToWorldPoint(point) {
		//var projectionViewMatrix = MultiplyMatrix4(projectionMatrix, CreateMatrix4FromMatrix3(worldMatrix))
		//var screenPoint = MultiplyVector3ToMatrix4(point, projectionViewMatrix)
		//var screenScaledPoint = MultiplyVector3(screenPoint, 10000.0)
		//return AddVector3(screenScaledPoint, centerOffcet)
		var worldPoint = point
		worldPoint = MultiplyVector3ToMatrix3(worldPoint, worldMatrix)
		worldPoint = AddVector3(worldPoint, CreateVector3(0.0, 0.0, -20.0))
		worldPoint = MultiplyVector3ToMatrix4(worldPoint, projectionMatrix)
		var screenScaledPoint = MultiplyVector3(worldPoint, 200.0)
		return AddVector3(screenScaledPoint, centerOffcet)
	}

	function render() {
		// clear
		canvas.fillStyle    = '#000011';  // black
		canvas.fillRect ( 0, 0, width, height);
		//var heroVisOnMap = [Math.floor(player.position[0]), Math.floor(player.position[1])];

		canvas.fillStyle= '#FFEEEE';  // red
		// canvas.beginPath();
		// canvas.arc(x, y, 10, 0, 2*Math.PI);
		// canvas.closePath();
		// canvas.fill();


		for (var i = 0; i < points.length; i++) {
			var position = ToWorldPoint(points[i])
			canvas.beginPath();
			canvas.arc(position[0], position[1], 3, 0, 2.0 * Math.PI);
			canvas.closePath();
			canvas.fill();			
		}


		// help
		canvas.fillStyle    = '#FFFFFF';  // black
		canvas.font = "14pt Arial";
		canvas.fillText("test", 10, 30);
		// canvas.fillText("Z / X - change height constant", 10, 50);
		// canvas.fillText("C / V - change tile aspect", 10, 70);
		// canvas.fillText("Camera angle " + camera.angle, 10, 90);
	}

	function update(dt) {
		// control
		// UP = 38
		// DOWN = 40
		// LEFT = 37
		// RIGHT = 39
		// W = 87
		// S = 83
		// A = 65
		// D = 68
		// space = 32
		var speed = 60.0 * dt;
		if (input.key[38] || input.key[87]) { // UP
			// worldMatrix = MultiplyMatrix3(worldMatrix, CreateRotationMatrix(rightVector, speed))
			y -= speed;
		}
		if (input.key[40] || input.key[83]) { // DOWN
			//worldMatrix = MultiplyMatrix3(worldMatrix, CreateRotationMatrix(rightVector, -speed))
			y += speed;
		}
		if (input.key[37] || input.key[65]) { // LEFT
			// worldMatrix = MultiplyMatrix3(worldMatrix, CreateRotationMatrix(upVector, speed))
			x -= speed;
		}
		if (input.key[39] || input.key[68]) { // RIGHT
			//worldMatrix = MultiplyMatrix3(worldMatrix, CreateRotationMatrix(upVector, -speed))
			x += speed;
		}
		//worldMatrix = CreateEulerMatrix3(x, 0, 0.0) // MultiplyMatrix3(CreateRotationMatrix3(upVector, x), CreateRotationMatrix3(rightVector, y))
		worldMatrix = MultiplyMatrix3(CreateMatrix3RotatedX(y), CreateMatrix3RotatedY(x))
		if (input.key[32]) { // space
		}
	}
	function frame() {
		now = timestamp();
		dt = dt + Math.min(1, (now - time) / 1000);
		if (dt > step) {
			dt = step;
		}
		update(step);
		render();
		time = now;
		requestAnimationFrame(frame);
	}
	requestAnimationFrame(frame);
	</script>
</html>